# Лабораторная работа 3

## Тема: Алгоритмический мини-пакет (структуры данных и сортировки)

* **Цель:** реализовать набор алгоритмов сортировки, структуры данных стека, функции вычисления факториала и чисел Фибоначчи, а также инструменты для генерации тестовых данных и бенчмаркинга с интерактивным CLI-интерфейсом.
* **Вариант:** факториал и Фибоначчи (рекурсивные и итеративные), сортировки (пузырьковая, быстрая, подсчетом, поразрядная, блочная, пирамидальная), стек на list с поддержкой min() за O(1), генераторы тестовых массивов, бенчмарк и решенная практика.
* **Используемые библиотеки:** `typer`, `random`, `time`, стандартная библиотека Python.

## Ограничения и допущения

- Запрещено использование встроенных `list.sort()` и `sorted()` в реализации алгоритмов сортировки.
- Bucket sort сортирует float в диапазоне [0, 1).
- Структура данных Stack выбрасывает исключение `InvalidStackOperation` при некорректных операциях (например, pop из пустого стека).
- Все команды доступны через интерактивный терминал с использованием библиотеки `typer`.
- Factorial и Fibonacci для отрицательных чисел возвращают -1 и выводят сообщение об ошибке.
- Все сортировки, кроме bucket принимают исключительно целые числа. При вводе вещественных чисел, их дробная часть отбрасывается.

## Реализованный функционал

Выполнено:
- Easy
- Medium: генераторы и тайминг
- Бенчмаркинг + отчет
- CLI
- Практика LeetCode и HackerRank

### Easy: базовые функции и сортировки

#### Факториал и Фибоначчи

- `factorial <n> [-r]` - вычисление факториала числа n.
  - Без флага `-r` используется итеративная реализация с предподсчетом значений в списке.
  - С флагом `-r` или `--recursive` применяется рекурсивный алгоритм.
  - Для отрицательных чисел выводится сообщение об ошибке.
  - При превышении глубины рекурсии выводится сообщение об ошибке.

- `fibo <n> [-r]` - вычисление n-го числа Фибоначчи.
  - Без флага `-r` используется итеративная реализация с накоплением значений в списке.
  - С флагом `-r` или `--recursive` применяется рекурсивный алгоритм.
  - Для отрицательных чисел выводится сообщение об ошибке.
  - При превышении глубины рекурсии выводится сообщение об ошибке.

#### Алгоритмы сортировки

- `sort <algorithm> <array>` - сортировка массива выбранным алгоритмом.
  - Поддерживаемые алгоритмы:
    - `bubble` - сортировка пузырьком
    - `counting` - сортировка подсчетом
    - `quick` - быстрая сортировка
    - `radix` - поразрядная сортировка
    - `bucket` - блочная сортировка для float в диапазоне [0, 1)
    - `heap` - пирамидальная сортировка
  - Формат ввода массива: строка вида `[5,2,8,1]`, `[0.5,0.1,0.9]` или `gen`
  - При вводе `gen`, берется сгенерированный раннее список
  - При некорректном вводе выводится сообщение об ошибке.

#### Структура данных: Stack

- `stack-new` - создание нового стека.
  - Стеки нумеруются автоматически.

- `stack-current` - вывод номера текущего выбранного стека.

- `stack-checkout <N>` - переключение на стек с номером N.
  - Если стека не существует, выводится сообщение об ошибке.

- `stack-push <number>` - добавление элемента в текущий стек.
  - Если стек не выбран, выводится сообщение об ошибке.

- `stack-pop` - извлечение элемента из текущего стека.
  - Если стек не выбран или пуст, выводится сообщение об ошибке.

- `stack-peek` - просмотр вершины стека без извлечения.

- `stack-min [N]` - получение минимального элемента из стека (или текущего стека).
  - Если стек не выбран или пуст, выводится сообщение об ошибке.

- `stack-size [N]` - вывод размера стека N (или текущего стека).

- `stack-show [N]` - вывод содержимого стека N (или текущего стека).

- `stack-clear [N]` - очистка стека N (или текущего стека).

- `stack-list` - вывод списка всех созданных стеков с их содержимым.

- `stack-remove [N]` - удаление стека N (или текущего стека).
  - Если стека не существует или стек не выбран, выводится сообщение об ошибке.


### Medium: генераторы и бенчмаркинг

#### Генерация тестовых данных

- `generate-integers [N], [lo], [hi], [-d], [-s <number>])` - генерация массива из n случайных целых чисел в диапазоне [lo, hi].
  - Флаг `-d` гарантирует уникальность элементов.
  - Флаг + параметр `-s` задает seed генерации.

- `generate-nearly [N], [swaps] [-s <number>]` - генерация почти отсортированного массива.
  - Создается отсортированный массив, затем выполняется `swaps` случайных перестановок.
  - Флаг + параметр `-s` задает seed генерации.

- `generate-duplicates [N], [k_unique] [-s <number>]` - генерация массива с большим количеством дубликатов.
  - Массив длины n содержит только `k_unique` уникальных значений.
  - Флаг + параметр `-s` задает seed генерации.

- `generate-reverse [N]` - генерация массива, отсортированного в обратном порядке [n-1, n-2, ..., 1, 0].

- `generate-floats [N], [lo], [hi], [-s <number>]` - генерация массива вещественных чисел для bucket sort.
  - Флаг + параметр `-s` задает seed генерации.

- `generate-show` - выводит последний сгенерированный массив. Именно он используется при вводе `gen` в сортировках.

#### Бенчмаркинг

- `benchmark [seed]` - выводит отчет с бенчмарками. Автоматически генерирует списки и считает время их сортировки.
  - `seed` задает seed генерации. Если не указать, выбирается seed=0.
  - Время выводится в секундах, а также время увеличивается в 1000 раз для наглядности.

## Алгоритм работы терминала

1. При запуске программы инициализируется интерактивная оболочка с помощью библиотеки `typer`.
2. Создается состояние приложения `AppState`.
3. Регистрируются все команды: `factorial`, `fibo`, `sort` и др.
4. Пользователю выводится приглашение для ввода команды или `exit` для завершения работы.
5. Введенная команда парсится библиотекой `typer` и вызывается соответствующая функция.
6. Результат выполнения выводится в консоль, состояние приложения обновляется при необходимости.
7. Цикл продолжается до ввода команды `exit`.

## Интересные кейсы для проверки

- Вычисление факториала и Фибоначчи для граничных значений (0, 1, отрицательные числа).
- Попытка выполнить факториал и Фибоначчи с выходом за границы рекурсии.
- Сортировка bucket со значениями не в диапазоне [0, 1).
- Попытка выполнить `stack-pop` из пустого стека для проверки обработки исключений.
- Проверка работы `stack-min` после добавления и удаления элементов.
- Генерация воспроизводимых массивов с одинаковым seed.

## Установка и запуск
```bash
git clone <ваш-репозиторий>
cd <папка-проекта>
```
Установка зависимостей
```bash
uv sync
source .venv/bin/activate
```
Запуск интерактивного терминала
```bash
python -m src.main
```
После запуска введите `--help` для просмотра доступных команд.

Примеры команд:
```bash
factorial 5
fibo 10 -r
sort bubble​ [1,0,2,4,10,1]
stack-new
benchmark 10
exit
```

Запуск тестов:

```bash
pytest -q
```


## Структура проекта
```
├── practice/ # Решенные задачи из практики
├── src/
│ ├── main.py # Интерактивный терминал
│ ├── factorial.py # Функции факториала
│ ├── fibo.py # Функции Фибоначчи
│ ├── sorts.py # Алгоритмы сортировки
│ ├── stack.py # Класс Stack
│ ├── state.py # Класс состояний приложения
│ ├── stack_commands.py # CLI команды для стека
│ ├── generate_tests.py # Генераторы тестовых данных
│ ├── benchmark.py # Функции бенчмаркинга
│ └── errors.py # Пользовательские исключения
├── tests/
│ ├── test_factorial.py
│ ├── test_fibo.py
│ ├── test_sorts.py
│ ├── test_stack.py
│ ├── test_stack_commands.py
│ ├── test_generate_tests.py
│ ├── test_benchmark.py
│ └── conftest.py
└── README.md
```
